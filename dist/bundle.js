(()=>{var e={5867:(e,t,r)=>{const a=r(3392);addCalendar=(e,t,r,o,s)=>new Promise(((n,i)=>{if(!(e&&t&&r&&o&&s))return i("No se ha recibido todos los datos"),!1;const d={dayText:e,dayCelebrate:t,isCelebrated:r,description:o,categoryId:s};a.addCalendar(d),n(d)})),getCalendar=e=>new Promise(((t,r)=>{t(a.getCalendar(e))})),updateCalendar=(e,t,r,o,s,n)=>new Promise((async(i,d)=>{if(!(e&&t&&r&&o&&s&&n))return d("No se ha recibido todos los datos"),!1;i(await a.updateCalendar(e,t,r,o,s,n))})),deleteCalendar=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteCalendar(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addCalendar,getCalendar,updateCalendar,deleteCalendar}},2009:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({dayText:{type:String,required:!0},dayCelebrate:{type:String,required:!0},isCelebrated:{type:String,required:!0},description:{type:String,defaul:""},categoryId:{type:o.Types.ObjectId,ref:"category"}},{collection:"calendar"});e.exports=a.model("calendar",s)},1955:(e,t,r)=>{const a=r(2127).Router(),o=r(5867),s=r(5628);a.post("/",((e,t)=>{o.addCalendar(e.body.dayText,e.body.dayCelebrate,e.body.isCelebrated,e.body.description,e.body.categoryId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idCalendar||null;o.getCalendar(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateCalendar(e.params.id,e.body.dayText,e.body.dayCelebrate,e.body.isCelebrated,e.body.description,e.body.categoryId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteCalendar(r).then((()=>{s.success(e,t,`Calendario ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},3392:(e,t,r)=>{const a=r(2009);r(9043).Connect(),addCalendar=e=>{new a(e).save()},getCalendar=async e=>{let t={};return null!=e&&{_id:e},await a.find().select({_id:0,dayText:1}).populate({path:"categoryId",select:"colorPosition imageUrl"})},updateCalendar=async(e,t,r,o,s,n)=>{const i=await a.findOne({_id:e});return i.dayText=t,i.dayCelebrate=r,i.isCelebrated=o,i.description=s,i.categoryId=n,await i.save()},deleteCalendar=e=>a.deleteOne({_id:e}),e.exports={addCalendar,getCalendar,updateCalendar,deleteCalendar}},1987:(e,t,r)=>{const a=r(3267);addCategory=(e,t,r)=>new Promise(((o,s)=>{if(!e||!t||!r)return s("No se ha recibido todos los datos"),!1;const n={name:e,colorPosition:t,imageUrl:r};a.addCategory(n),o(n)})),getCategory=e=>new Promise(((t,r)=>{t(a.getCategory(e))})),updateCategory=(e,t,r,o)=>new Promise((async(s,n)=>{if(!t||!r||!o)return n("No se ha recibido todos los datos"),!1;s(await a.updateCategory(e,t,r,o))})),deleteCategory=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteCategory(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addCategory,getCategory,updateCategory,deleteCategory}},3238:(e,t,r)=>{const a=r(5619),o=new(0,a.Schema)({name:{type:String,required:!0},colorPosition:{type:Array,required:!0},imageUrl:{type:String,defaul:""}},{collection:"category"});e.exports=a.model("category",o)},116:(e,t,r)=>{const a=r(2127).Router(),o=r(1987),s=r(5628);a.post("/",((e,t)=>{o.addCategory(e.body.name,e.body.colorPosition,e.body.imageUrl).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.name||null;o.getCategory(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateCategory(e.params.id,e.body.name,e.body.colorPosition,e.body.imageUrl).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteCategory(r).then((()=>{s.success(e,t,`Categoria ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},3267:(e,t,r)=>{const a=r(3238);r(9043).Connect(),addCategory=e=>{new a(e).save()},getCategory=async e=>{let t={};return null!=e&&(t={name:e}),await a.find(t)},updateCategory=async(e,t,r,o)=>{const s=await a.findOne({_id:e});return s.name=t,s.colorPosition=r,s.imageUrl=o,await s.save()},deleteCategory=e=>a.deleteOne({_id:e}),e.exports={addCategory,getCategory,updateCategory,deleteCategory}},8643:(e,t,r)=>{const a=r(9383);addChallengeUser=(e,t)=>new Promise(((r,o)=>{if(!e||!t)return o("No se ha recibido todos los datos"),!1;const s={challengeId:e,userId:t};a.addChallengeUser(s),r(s)})),getChallengeUser=e=>new Promise(((t,r)=>{t(a.getChallengeUser(e))})),updateChallengeUser=(e,t,r)=>new Promise((async(o,s)=>{if(!e||!t||!r)return s("No se ha recibido todos los datos"),!1;o(await a.updateChallengeUser(e,t,r))})),deleteChallengeUser=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteChallengeUser(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addChallengeUser,getChallengeUser,updateChallengeUser,deleteChallengeUser}},6466:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({challengeId:{type:o.Types.ObjectId,required:!0,ref:"challenge"},userId:{type:o.Types.ObjectId,required:!0,ref:"user"},statusChallenge:{type:Number,required:!1,default:0},imageUrl:{type:String,required:!1,default:""}},{collection:"challengeUser"});e.exports=a.model("challengeUser",s)},810:(e,t,r)=>{const a=r(2127).Router(),o=r(8643),s=r(5628);a.post("/",((e,t)=>{o.addChallengeUser(e.body.challengeId,e.body.userId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idChallengeUser||null;o.getChallengeUser(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateChallengeUser(e.params.id,e.body.challengeId,e.body.userId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteChallengeUser(r).then((()=>{s.success(e,t,`ChallengeUserio ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},9383:(e,t,r)=>{const a=r(6466);r(9043).Connect(),addChallengeUser=async e=>{const t=new a(e);return await t.save()},getChallengeUser=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateChallengeUser=async(e,t,r)=>{const o=await a.findOne({_id:e});return o.challengeId=t,o.userId=r,await o.save()},deleteChallengeUser=e=>a.deleteOne({_id:e}),deleteChallengeUserByIdChallenge=e=>a.deleteOne({challengeId:e}),e.exports={addChallengeUser,getChallengeUser,updateChallengeUser,deleteChallengeUser,deleteChallengeUserByIdChallenge}},7788:(e,t,r)=>{const a=r(5181),o=r(9383),s=r(9763),n=r(5747);addChallenge=(e,t,r,o,s)=>new Promise(((n,i)=>{if(!(e&&t&&r&&o&&s))return i("No se ha recibido todos los datos"),!1;let d=r.slice(0,49);r.length>=50&&(d=`${d}...`);const c={name:e,categoryId:t,description:r,shortDescription:d,reward:o,ambientalImpact:s};a.addChallenge(c),n(c)})),getChallenge=e=>new Promise(((t,r)=>{t(a.getChallenge(e))})),updateChallenge=(e,t,r,o,s,n)=>new Promise((async(i,d)=>{if(!(e&&t&&r&&o&&s&&n))return d("No se ha recibido todos los datos"),!1;let c=o.slice(0,49);o.length>=50&&(c=`${c}...`),i(await a.updateChallenge(e,t,r,o,c,s,n))})),deleteChallenge=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteChallenge(e).then((()=>{t()})).catch((e=>{r(e)}))})),addChallengeUser=(e,t,r,a)=>new Promise((async(i,d)=>{if(!(e&&t&&r&&a))return d({message:"Error Interno, consulte al soporte"}),!1;const c={challengeId:t,userId:e,imageUrl:`/img/challengeUser/${e}/${t}.jpg`};if(await o.addChallengeUser(c))if(await s.changeReward(e,r,a))i({message:"ok"});else{await o.deleteChallengeUserByIdChallenge(t);const r=`./public/img/challengeUser/${e}/${t}.jpg`;n.unlinkSync(r),d({message:"Ocurrió un error al aumentar tu experiencia y AmbientalsCoints"})}else d({message:"Ocurrió un error al guardar el reto"})})),e.exports={addChallenge,getChallenge,updateChallenge,deleteChallenge,addChallengeUser}},8366:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({name:{type:String,required:!0},categoryId:{type:o.Types.ObjectId,ref:"category"},description:{type:String,required:!0},shortDescription:{type:String,required:!1},reward:{experiencie:{type:Number,required:!0},coint:{type:Number,required:!0}},ambientalImpact:{type:String,required:!0},isCompleted:{type:Boolean,default:!1}},{collection:"challenge"});e.exports=a.model("challenge",s)},9737:(e,t,r)=>{const a=r(2127).Router(),o=r(7788),s=r(5628),{uploadChallengeUser:n}=r(5489),{generateFolder:i,passImg:d}=r(2310);a.post("/saveImage",n.single("photoChallengue"),(async(e,t)=>{await i(e.body.idUser),await d(e.body.idUser,e.body.idChallenge),o.addChallengeUser(e.body.idUser,e.body.idChallenge,e.body.newCoint,e.body.newExperience).then((r=>{s.success(e,t,r.message,200)})).catch((r=>{s.error(e,t,r.message,500,r)}))})),a.post("/",((e,t)=>{o.addChallenge(e.body.name,e.body.categoryId,e.body.description,e.body.reward,e.body.ambientalImpact).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idChallenge||null;o.getChallenge(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateChallenge(e.params.id,e.body.name,e.body.categoryId,e.body.description,e.body.reward,e.body.ambientalImpact).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteChallenge(r).then((()=>{s.success(e,t,`Challengeio ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},5181:(e,t,r)=>{const a=r(8366);r(9043).Connect(),addChallenge=e=>{new a(e).save()},getChallenge=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateChallenge=async(e,t,r,o,s,n,i)=>{const d=await a.findOne({_id:e});return d.name=t,d.categoryId=r,d.description=o,d.shortDescription=s,d.reward=n,d.ambientalImpact=i,await d.save()},deleteChallenge=e=>a.deleteOne({_id:e}),e.exports={addChallenge,getChallenge,updateChallenge,deleteChallenge}},1020:(e,t,r)=>{const a=r(3035);addConfiguration=(e,t,r)=>new Promise(((o,s)=>{if(!e||!t||!r)return s("No se ha recibido todos los datos"),!1;const n={dailyActivity:e,socialLinks:t,Links:r};a.addConfiguration(n),o(n)})),getConfiguration=e=>new Promise(((t,r)=>{t(a.getConfiguration(e))})),updateConfiguration=(e,t,r,o)=>new Promise((async(s,n)=>{if(!(e&&t&&r&&o))return n("No se ha recibido todos los datos"),!1;s(await a.updateConfiguration(e,t,r,o))})),deleteConfiguration=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteConfiguration(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addConfiguration,getConfiguration,updateConfiguration,deleteConfiguration}},5948:(e,t,r)=>{const a=r(5619),o=new(0,a.Schema)({dailyActivity:{type:Number,required:!0,default:0},socialLinks:{facebook:{type:String,required:!1},instagram:{type:String,required:!1}},Links:{privacyPolicies:{type:String,required:!1},termsAndConditions:{type:String,required:!1},suport:{type:String,required:!1}}},{collection:"configuration"});e.exports=a.model("configuration",o)},7499:(e,t,r)=>{const a=r(2127).Router(),o=r(1020),s=r(5628);a.post("/",((e,t)=>{o.addConfiguration(e.body.dailyActivity,e.body.socialLinks,e.body.Links).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idConfiguration||null;o.getConfiguration(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateConfiguration(e.params.id,e.body.dailyActivity,e.body.socialLinks,e.body.Links).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteConfiguration(r).then((()=>{s.success(e,t,`Configuration ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},3035:(e,t,r)=>{const a=r(5948);r(9043).Connect(),addConfiguration=e=>{new a(e).save()},getConfiguration=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateConfiguration=async(e,t,r,o)=>{const s=await a.findOne({_id:e});return s.dailyActivity=t,s.socialLinks=r,s.Links=o,await s.save()},deleteConfiguration=e=>a.deleteOne({_id:e}),e.exports={addConfiguration,getConfiguration,updateConfiguration,deleteConfiguration}},5155:(e,t,r)=>{const a=r(7952);addCourse=(e,t,r)=>new Promise(((o,s)=>{if(!e||!t||!r)return s("No se ha recibido todos los datos"),!1;const n={name:e,description:t,categoryId:r};a.addCourse(n),o(n)})),getCourse=e=>new Promise(((t,r)=>{t(a.getCourse(e))})),updateCourse=(e,t,r,o)=>new Promise((async(s,n)=>{if(!(e&&t&&r&&o))return n("No se ha recibido todos los datos"),!1;s(await a.updateCourse(e,t,r,o))})),deleteCourse=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteCourse(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addCourse,getCourse,updateCourse,deleteCourse}},3402:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({name:{type:String,required:!0},description:{type:String,required:!0},categoryId:{type:o.Types.ObjectId,ref:"category"}},{collection:"course"});e.exports=a.model("course",s)},9668:(e,t,r)=>{const a=r(2127).Router(),o=r(5155),s=r(5628);a.post("/",((e,t)=>{o.addCourse(e.body.name,e.body.description,e.body.categoryId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idCourse||null;o.getCourse(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateCourse(e.params.id,e.body.name,e.body.description,e.body.categoryId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteCourse(r).then((()=>{s.success(e,t,`Curso ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},7952:(e,t,r)=>{const a=r(3402);r(9043).Connect(),addCourse=e=>{new a(e).save()},getCourse=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateCourse=async(e,t,r,o)=>{const s=await a.findOne({_id:e});return s.name=t,s.description=r,s.categoryId=o,await s.save()},deleteCourse=e=>a.deleteOne({_id:e}),e.exports={addCourse,getCourse,updateCourse,deleteCourse}},8705:(e,t,r)=>{const a=r(3499);addFunFactsUser=(e,t)=>new Promise(((r,o)=>{if(!e||!t)return o("No se ha recibido todos los datos"),!1;const s={userId:e,funFactsId:t};a.addFunFactsUser(s),r(s)})),getFunFactsUser=e=>new Promise(((t,r)=>{t(a.getFunFactsUser(e))})),updateFunFactsUser=(e,t,r)=>new Promise((async(o,s)=>{if(!t||!r)return s("No se ha recibido todos los datos"),!1;o(await a.updateFunFactsUser(e,t,r))})),deleteFunFactsUser=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteFunFactsUser(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addFunFactsUser,getFunFactsUser,updateFunFactsUser,deleteFunFactsUser}},2692:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({userId:{type:o.Types.ObjectId,ref:"user"},funFactsId:{type:o.Types.ObjectId,ref:"funFacts"}},{collection:"funFactsUser"});e.exports=a.model("funFactsUser",s)},3815:(e,t,r)=>{const a=r(2127).Router(),o=r(8705),s=r(5628);a.post("/",((e,t)=>{o.addFunFactsUser(e.body.userId,e.body.funFactsId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idFunFactsUser||null;o.getFunFactsUser(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateFunFactsUser(e.params.id,e.body.userId,e.body.funFactsId).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteFunFactsUser(r).then((()=>{s.success(e,t,`FunFactsUserio ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},3499:(e,t,r)=>{const a=r(2692);r(9043).Connect(),addFunFactsUser=e=>{new a(e).save()},getFunFactsUser=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateFunFactsUser=async(e,t,r)=>{const o=await a.findOne({_id:e});return o.userId=t,o.funFactsId=r,await o.save()},deleteFunFactsUser=e=>a.deleteOne({_id:e}),e.exports={addFunFactsUser,getFunFactsUser,updateFunFactsUser,deleteFunFactsUser}},256:(e,t,r)=>{const a=r(4328);addFunFacts=e=>new Promise(((t,r)=>{if(!e)return r("No se ha recibido todos los datos"),!1;const o={content:e};a.addFunFacts(o),t(o)})),getFunFacts=e=>new Promise(((t,r)=>{t(a.getFunFacts(e))})),updateFunFacts=(e,t)=>new Promise((async(r,o)=>{if(!e||!t)return o("No se ha recibido todos los datos"),!1;r(await a.updateFunFacts(e,t))})),deleteFunFacts=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteFunFacts(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addFunFacts,getFunFacts,updateFunFacts,deleteFunFacts}},4742:(e,t,r)=>{const a=r(5619),o=new(0,a.Schema)({content:{type:String,required:!0}},{collection:"funFacts"});e.exports=a.model("funFacts",o)},1900:(e,t,r)=>{const a=r(2127).Router(),o=r(256),s=r(5628);a.post("/",((e,t)=>{o.addFunFacts(e.body.content).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idFunFacts||null;o.getFunFacts(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateFunFacts(e.params.id,e.body.content).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteFunFacts(r).then((()=>{s.success(e,t,`funFactsio ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},4328:(e,t,r)=>{const a=r(4742);r(9043).Connect(),addFunFacts=e=>{new a(e).save()},getFunFacts=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateFunFacts=async(e,t)=>{const r=await a.findOne({_id:e});return r.content=t,await r.save()},deleteFunFacts=e=>a.deleteOne({_id:e}),e.exports={addFunFacts,getFunFacts,updateFunFacts,deleteFunFacts}},1958:(e,t,r)=>{const a=r(3687);getData=e=>new Promise(((t,r)=>{t(a.getData(e))})),e.exports={getData}},513:(e,t,r)=>{const a=r(2127).Router(),o=r(1958),s=r(5628);a.get("/",((e,t)=>{const r=e.body.email||null;r?o.getData(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)})):s.error(e,t,"No se ha recibido el email",500,"No se ha recibido el email")})),e.exports=a},3687:(e,t,r)=>{const a=r(9043),o=r(6115),s=r(3402),n=r(1962),i=r(6466),d=r(4742),c=r(2692),l=r(8366),u=r(756),p=r(3238),g=r(2009),h=r(2143),m=r(5013),y=r(8479),w=r(5948),C=r(5750);a.Connect(),getData=async e=>new Promise((async(t,r)=>{null!=e&&(filter={email:e});const a=await o.findOne(filter).select({_id:1,names:1,birdOfDate:1,coint:1,experience:1,imageUrl:1});if(null==a)return void r("El usuario no esta registrado");let I;I=await m.find({userId:a._id}).populate({path:"itemId",select:"title description urlImage"});const b=await d.find(),f=await c.find({userId:a._id});let F=[];b.map((e=>{F.push(e._id.toString())}));let U=[];f.map((e=>{U.push(e.funFactsId.toString())}));var S=F.filter((e=>!U.includes(e)));const D=S.length;let N,x;if(0!=D){do{N=getRandomInt(0,D)}while(N==D);const e=S[N];x=await d.findOne({_id:e})}else x={};const{isBirthday:E,edad:v}=C.getAge(a.birdOfDate);let P=[],A=[],q={path:"categoryId",select:"colorPosition imageUrl"};const _=await n.find({userId:a._id});let T=[];if(_.map((e=>{T.push(e.topics.toString())})),v<15){P=await s.find().populate(q);let e=[],t={};for(let r=0;r<P.length;r++)e=await h.find({courseId:P[r]._id}),e.map(((t,r)=>{T.map((a=>{if(t._id==a){let t=e[r];t={reward:t.reward,content:t.content,answers:t.answers,isCompleted:!0,_id:t._id,name:t.name,courseId:t.courseId,question:t.question,correctAnswer:t.correctAnswer,imageTopic:t.imageTopic},e.splice(r,1),e.splice(r,0,t)}}))})),t={_id:P[r]._id,name:P[r].name,description:P[r].description,categoryId:P[r].categoryId,topic:e},A.push(t)}else{const e=await i.find({userId:a._id});let t=[];e.map((e=>{t.push(e.challengeId.toString())})),challenges=await l.find();const r=[];challenges.map((e=>{r.includes(e.categoryId.toString())||r.push(e.categoryId.toString())}));let o={};for(let e=0;e<r.length;e++){categoryChallenge=await p.find({_id:r[e]}).select({_id:1,name:1,colorPosition:1,imageUrl:1}),challenge=await l.find({categoryId:r[e]}).select({_id:1,name:1,description:1,shortDescription:1,ambientalImpact:1,reward:1,isCompleted:1});let a=0;challenge.map(((e,r)=>{t.map((t=>{if(e._id==t){let e=challenge[r];a+=1,e={_id:e._id,name:e.name,description:e.description,shortDescription:e.shortDescription,ambientalImpact:e.ambientalImpact,reward:e.reward,isCompleted:!0},challenge.splice(r,1),challenge.splice(r,0,e)}}))})),o={_id:categoryChallenge[0]._id,name:categoryChallenge[0].name,categoryId:{colorPosition:categoryChallenge[0].colorPosition,imageUrl:categoryChallenge[0].imageUrl},challenge},A.push(o)}}const O=await u.find(),B=await g.find().populate(q),$=await y.find().sort([["datePublished",-1]]),k=await w.find();t({user:{_id:a._id,names:a.names,birdOfDate:a.birdOfDate,age:v,isBirthday:E,imageUrl:a.imageUrl,experience:a.experience,coint:a.coint},content:A,storeItem:O,calendar:B,news:$,configuration:k,yourShopping:I,funFacts:x})})),getRandomInt=(e,t)=>Math.floor(Math.random()*(t-e))+e,e.exports={getData}},4221:(e,t,r)=>{const a=r(8716),o=r(3691),s=r(5747);addNews=(e,t,r,s,n)=>new Promise((async(i,d)=>{if(!e||!t||!r)return d("No se ha recibido todos los datos"),!1;const c=o.getFullDate();let l=t.slice(0,49);t.length>=50&&(l=`${l}...`);const u={title:e,description:t,shortDescription:l,datePublished:c,imageUrl:r,nameButton:s,linkButton:n};await a.addNews(u),i(await a.updateUrl(r))})),getNews=e=>new Promise(((t,r)=>{t(a.getNews(e))})),updateNews=(e,t,r,s)=>new Promise((async(n,i)=>{if(!(e&&t&&r&&s))return i("No se ha recibido todos los datos"),!1;const d=o.getDate();let c=r.slice(0,49);r.length>=50&&(c=`${c}...`),n(await a.updateNews(e,t,r,c,d,s))})),deleteNews=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;let o=`./public/img/news/${e}.jpg`;s.unlinkSync(o),a.deleteNews(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addNews,getNews,updateNews,deleteNews}},8479:(e,t,r)=>{const a=r(5619),o=new(0,a.Schema)({title:{type:String,required:!0},description:{type:String,required:!0},shortDescription:{type:String,required:!1},datePublished:{type:String,required:!1},imageUrl:{type:String,default:""},nameButton:{type:String,default:""},linkButton:{type:String,default:""}},{collection:"news"});e.exports=a.model("news",o)},3009:(e,t,r)=>{const a=r(2127).Router(),o=r(4221),s=r(5628);a.post("/",((e,t)=>{o.addNews(e.body.title,e.body.description,e.body.imageUrl,e.body.nameButton,e.body.linkButton).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.post("/listNews",((e,t)=>{const r=e.query.idNews||null;o.getNews(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateNews(e.params.id,e.body.title,e.body.description,e.body.imageUrl).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteNews(r).then((()=>{s.success(e,t,`News ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},8716:(e,t,r)=>{const a=r(8479);r(9043).Connect(),addNews=e=>{new a(e).save()},getNews=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t).sort([["datePublished",-1]])},updateNews=async(e,t,r,o,s,n)=>{const i=await a.findOne({_id:e});return i.title=t,i.description=r,i.shortDescription=o,i.datePublished=s,i.imageUrl=n,await i.save()},deleteNews=e=>a.deleteOne({_id:e}),updateUrl=async e=>{const t=await a.findOne({imageUrl:e});return t.imageUrl=`/img/news/${t._id}.jpg`,await t.save()},e.exports={addNews,getNews,updateNews,deleteNews,updateUrl}},3127:(e,t,r)=>{const a=r(8572),o=r(5013),s=r(5747);addStoreItem=(e,t,r,o)=>new Promise((async(s,n)=>{if(!(e&&t&&r&&o))return n("No se ha recibido todos los datos"),!1;const i={title:e,description:t,price:parseInt(r),urlImage:o};await a.addStoreItem(i),s(await a.updateUrl(o))})),getStoreItem=e=>new Promise(((t,r)=>{t(a.getStoreItem(e))})),updateStoreItem=(e,t,r,o,s)=>new Promise((async(n,i)=>{if(!(e&&t&&r&&o&&s))return i("No se ha recibido todos los datos"),!1;n(await a.updateStoreItem(e,t,r,o,s))})),deleteStoreItem=e=>new Promise((async(t,r)=>{if(!e)return t("No se ha encontrado el store Item"),!1;if(await o.findOne({itemId:e}))return t("No se puede eliminar el Item, los usuarios ya han realizado compras con este Item."),!1;let n=`./public/img/storeItem/${e}.jpg`;s.unlinkSync(n),a.deleteStoreItem(e).then((()=>{t("item eliminado correctamente")})).catch((e=>{r(e)}))})),e.exports={addStoreItem,getStoreItem,updateStoreItem,deleteStoreItem}},756:(e,t,r)=>{const a=r(5619),o=new(0,a.Schema)({title:{type:String,required:!0},description:{type:String,required:!0},price:{type:Number,required:!0},urlImage:{type:String,required:!0,default:String}},{collection:"storeItem"});e.exports=a.model("storeItem",o)},6173:(e,t,r)=>{const a=r(2127).Router(),o=r(3127),s=r(5628);a.post("/",((e,t)=>{o.addStoreItem(e.body.title,e.body.description,e.body.price,e.body.urlImage).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.post("/listStoreItem",((e,t)=>{const r=e.query.idStoreItem||null;o.getStoreItem(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateStoreItem(e.params.id,e.body.title,e.body.description,e.body.price,e.body.urlImage).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteStoreItem(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,r,500,r)}))})),e.exports=a},8572:(e,t,r)=>{const a=r(756);r(9043).Connect(),addStoreItem=async e=>{const t=new a(e);return await t.save()},getStoreItem=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateStoreItem=async(e,t,r,o,s)=>{const n=await a.findOne({_id:e});return n.title=t,n.description=r,n.price=o,n.urlImage=s,await n.save()},deleteStoreItem=e=>a.deleteOne({_id:e}),updateUrl=async e=>{const t=await a.findOne({urlImage:e});return t.urlImage=`/img/storeItem/${t._id}.jpg`,await t.save()},e.exports={addStoreItem,getStoreItem,updateStoreItem,deleteStoreItem,updateUrl}},3084:(e,t,r)=>{const a=r(3893);addTopicsUser=(e,t)=>new Promise(((r,o)=>{if(!e||!t)return o("No se ha recibido todos los datos"),!1;const s={userId:e,topics:t};a.addTopicsUser(s),r(s)})),getTopicsUser=e=>new Promise(((t,r)=>{t(a.getTopicsUser(e))})),updateTopicsUser=(e,t,r,o)=>new Promise((async(s,n)=>{if(!(e&&t&&r&&o))return n("No se ha recibido todos los datos"),!1;s(await a.updateTopicsUser(e,t,r,o))})),deleteTopicsUser=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteTopicsUser(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addTopicsUser,getTopicsUser,updateTopicsUser,deleteTopicsUser}},1962:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({userId:{type:o.Types.ObjectId,ref:"user",required:!0},topics:{type:o.Types.ObjectId,ref:"topics",required:!0}},{collection:"topicsUser"});e.exports=a.model("topicsUser",s)},3155:(e,t,r)=>{const a=r(2127).Router(),o=r(3084),s=r(5628);a.post("/",((e,t)=>{o.addTopicsUser(e.body.userId,e.body.topics).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idTopicsUser||null;o.getTopicsUser(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateTopicsUser(e.params.id,e.body.userId,e.body.topics,e.body.status).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteTopicsUser(r).then((()=>{s.success(e,t,`TopicsUser ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},3893:(e,t,r)=>{const a=r(1962);r(9043).Connect(),addTopicsUser=e=>{new a(e).save()},getTopicsUser=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateTopicsUser=async(e,t,r,o)=>{const s=await a.findOne({_id:e});return s.userId=t,s.topics=r,s.status=o,await s.save()},deleteTopicsUser=e=>a.deleteOne({_id:e}),e.exports={addTopicsUser,getTopicsUser,updateTopicsUser,deleteTopicsUser}},5599:(e,t,r)=>{const a=r(9757);addTopics=(e,t,r,o,s,n,i,d)=>new Promise(((c,l)=>{if(!(e&&t&&r&&o&&s&&n&&i&&d))return l("No se ha recibido todos los datos"),!1;const u={name:e,content:t,courseId:r,question:o,answers:s,correctAnswer:n,reward:i,imageTopic:d};a.addTopics(u),c(u)})),getTopics=e=>new Promise(((t,r)=>{t(a.getTopics(e))})),updateTopics=(e,t,r,o,s,n,i,d)=>new Promise((async(c,l)=>{if(!(e&&t&&r&&o&&s&&n&&i&&d))return l("No se ha recibido todos los datos"),!1;c(await a.updateTopics(e,t,r,o,s,n,i,d))})),deleteTopics=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteTopics(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addTopics,getTopics,updateTopics,deleteTopics}},2143:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({name:{type:String,required:!0},content:{type:Array,required:!0},courseId:{type:o.Types.ObjectId,ref:"Course",required:!0},question:{type:String,required:!0},answers:{type:Array,required:!0},correctAnswer:{type:String,required:!0},reward:{experiencie:{type:Number,required:!0},coint:{type:Number,required:!0}},imageTopic:{type:String,required:!0},isCompleted:{type:Boolean,default:!1}},{collection:"topics"});e.exports=a.model("topics",s)},4674:(e,t,r)=>{const a=r(2127).Router(),o=r(5599),s=r(5628);a.post("/",((e,t)=>{o.addTopics(e.body.name,e.body.content,e.body.courseId,e.body.question,e.body.answers,e.body.correctAnswer,e.body.reward,e.body.imageTopic).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idTopics||null;o.getTopics(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateTopics(e.params.id,e.body.name,e.body.content,e.body.courseId,e.body.question,e.body.answers,e.body.correctAnswer,e.body.reward).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteTopics(r).then((()=>{s.success(e,t,`Topics ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},9757:(e,t,r)=>{const a=r(2143);r(9043).Connect(),addTopics=e=>{new a(e).save()},getTopics=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateTopics=async(e,t,r,o,s,n,i,d)=>{const c=await a.findOne({_id:e});return c.name=t,c.content=r,c.courseId=o,c.question=s,c.answers=n,c.correctAnswer=i,c.reward=d,await c.save()},deleteTopics=e=>a.deleteOne({_id:e}),e.exports={addTopics,getTopics,updateTopics,deleteTopics}},3812:(e,t,r)=>{const a=r(9763),o=r(3691),s=r(6115);addUser=(e,t,r,n,i,d)=>new Promise((async(c,l)=>{if(!(e&&t&&r&&n&&i&&d))return l("No se ha recibido todos los datos"),!1;if(filter={email:n},(await s.find(filter)).length>=1)return void l("El usuario existente");const u=o.getDate(),p={numberID:e,names:t,birdOfDate:r,email:n,phone:i,password:d,registerOfDate:u};a.addUser(p),c(p)})),loginUser=(e,t)=>new Promise((async(r,o)=>{const n=await s.findOne({email:e});n?n.password==t?r(a.loginUser(e,t)):o("Contraseña incorrecta"):o("El usuario no existe")})),changePassword=(e,t,r)=>new Promise((async(o,n)=>{const i=await s.findOne({_id:e});i?i.password==t?o(await a.updatePassword(e,r)):n("Contraseña actual incorrecta"):n("El usuario no existe")})),changeCoint=(e,t)=>new Promise((async(r,o)=>{await s.findOne({_id:e})?r(await a.changeCoint(e,t)):o("El usuario no existe")})),changeExperience=(e,t)=>new Promise((async(r,o)=>{await s.findOne({_id:e})?r(await a.changeExperience(e,t)):o("El usuario no existe")})),changeReward=(e,t,r)=>new Promise((async(o,n)=>{await s.findOne({_id:e})?o(await a.changeReward(e,t,r)):n("El usuario no existe")})),updateUser=(e,t,r,o,s,n,i,d,c,l)=>new Promise((async(u,p)=>{if(!(e&&t&&r&&o&&s&&n&&i&&d&&c&&l))return p("No se ha recibido todos los datos"),!1;u(await a.updateUser(e,t,r,o,s,n,i,d,c,l))})),deleteUser=e=>new Promise(((t,r)=>{if(!e)return r("No se ha recibido el id del usuario"),!1;a.deleteUser(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addUser,loginUser,updateUser,deleteUser,changePassword,changeCoint,changeExperience,changeReward}},6115:(e,t,r)=>{const a=r(5619),o=new(0,a.Schema)({numberID:{type:String,required:!0},names:{type:String,required:!0},birdOfDate:{type:String,required:!0},email:{type:String,required:!0},phone:{type:String,required:!0},password:{type:String,required:!0},registerOfDate:{type:String,required:!0},coint:{type:Number,required:!1,default:0},experience:{type:Number,default:0},imageUrl:{type:String,default:""}},{collection:"user"});e.exports=a.model("user",o)},395:(e,t,r)=>{const a=r(2127).Router(),o=r(3812),s=r(5628);a.post("/",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?o.addUser(e.body.idNumber,e.body.Names,e.body.dateOfBirth,e.body.Email,e.body.phone,e.body.password).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,r,500,r)})):s.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/login",((e,t)=>{const{email:r,password:a}=e.body;"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?null!=r&&null!=a?o.loginUser(r,a).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,r,500,r)})):s.error(e,t,"Se necesita que se envie el correo y contraseña",500,"No se ha recibido las credenciales"):s.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/changePassword",((e,t)=>{const{user:r,passwordActually:a,passwordNew:n}=e.body;"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?null!=r&&null!=a&&null!=n?o.changePassword(r,a,n).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,r,500,r)})):s.error(e,t,"Se necesita que se envie el usuario y contraseña a actualizar",500,"No se ha recibido los datos"):s.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/changeCoint",((e,t)=>{const{userId:r,newCoint:a}=e.body;"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?null!=r&&null!=a?o.changeCoint(r,a).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,r,500,r)})):s.error(e,t,"Se necesita que se envie el userId y el newCoint para actualizar",500,"No se ha recibido los datos"):s.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/changeExperience",((e,t)=>{const{userId:r,newExperience:a}=e.body;"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?null!=r&&null!=a?o.changeExperience(r,a).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,r,500,r)})):s.error(e,t,"Se necesita que se envie el userId y el newExperience para actualizar",500,"No se ha recibido los datos"):s.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/changeReward",((e,t)=>{const{userId:r,newCoint:a,newExperience:n}=e.body;"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?null!=r&&null!=a&&null!=n?o.changeReward(r,a,n).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,r,500,r)})):s.error(e,t,"Se necesita que se envie el userId, newCoint y el newExperience para actualizar",500,"No se ha recibido los datos"):s.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.patch("/:id",((e,t)=>{o.updateUser(e.params.id,e.body.numberID,e.body.names,e.body.birdOfDate,e.body.email,e.body.phone,e.body.password,e.body.coint,e.body.experience,e.body.imageUrl).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteUser(r).then((()=>{s.success(e,t,`Usuario ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},9763:(e,t,r)=>{const a=r(6115),o=r(9043),s=r(3691),n=r(3687);o.Connect(),addUser=e=>{new a(e).save()},loginUser=async(e,t)=>{let r=!1;const o=await a.findOne({email:e});let s={};return o?(t===o.password&&(r=!0,s=n.getData(e)),s):r},updateUser=async(e,t,r,o,n,i,d,c,l,u)=>{const p=await a.findOne({_id:e}),g=s.getDate();return p.numberID=t,p.names=r,p.birdOfDate=o,p.email=n,p.phone=i,p.password=d,p.registerOfDate=g,p.coint=c,p.experience=l,p.imageUrl=u,await p.save()},updatePassword=async(e,t)=>{const r=await a.findOne({_id:e}),o=s.getDate();return r.password=t,r.registerOfDate=o,await r.save()},changeCoint=async(e,t)=>{const r=await a.findOne({_id:e});return r.coint=t,await r.save()},changeExperience=async(e,t)=>{const r=await a.findOne({_id:e});return r.experience=t,await r.save()},changeReward=async(e,t,r)=>{const o=await a.findOne({_id:e});return o.coint=t,o.experience=r,await o.save()},deleteUser=e=>a.deleteOne({_id:e}),e.exports={addUser,loginUser,updateUser,updatePassword,deleteUser,changeCoint,changeExperience,changeReward}},2460:(e,t,r)=>{const a=r(9739),o=r(3852),s=r(6115),n=r(5013),i=r(3691),d=r(8479),c=r(756);addUser=(e,t)=>new Promise((async(r,s)=>{if(!e||!t)return s("No se ha recibido todos los datos"),!1;if(filter={username:e},(await o.find(filter)).length>=1)return void s("El usuario existente");const n={username:e,password:t};a.addUser(n),r(n)})),updateUser=(e,t,r)=>new Promise((async(s,n)=>{if(!e||!t||!r)return n("No se ha recibido todos los datos"),!1;const i=await o.findOne({username:e});return i?i.password!=t?(n("la contraseña actual es incorrecta"),!1):void s(await a.updateUser(e,r)):(n("el usuario no existe"),!1)})),loginUser=(e,t)=>new Promise((async(r,a)=>{const s=await o.findOne({username:e});s?s.password==t?s.username==e&&s.password==t&&r("Ok"):a("Contraseña incorrecta"):a("El usuario no existe")})),getUsers=()=>new Promise((async(e,t)=>{e(await s.find())})),getData=e=>new Promise((async(t,r)=>{let o;try{o=await s.findOne({_id:e.toString()})}catch(e){r(e)}t(a.getData(o.email))})),delivery=e=>new Promise((async(t,r)=>{if(!e)return r("No se ha recibido el item de compra"),!1;const o=await n.findOne({_id:e}),s=i.getDate();if(!o)return r("el item de compra no existe"),!1;t(await a.delivery(e,s))})),returnDelivery=e=>new Promise((async(t,r)=>e?await n.findOne({_id:e})?void t(await a.returnDelivery(e)):(r("el item de compra no existe"),!1):(r("No se ha recibido el item de compra"),!1))),updateNewsSI=(e,t,r,a,o)=>new Promise((async(s,n)=>{if(!(e&&t&&r&&a&&o))return n("No se ha recibido todos los datos"),!1;const c=await d.findOne({_id:e}),l=i.getFullDate();let u=r.slice(0,49);r.length>=50&&(u=`${u}...`),c.title=t,c.description=r,c.shortDescription=u,c.datePublished=l,c.nameButton=a,c.linkButton=o,s(await c.save())})),updateNewsCI=(e,t,r,a,o)=>new Promise((async(s,n)=>{if(!(e&&t&&r&&a&&o))return n("No se ha recibido todos los datos"),!1;const c=await d.findOne({_id:e}),l=i.getFullDate();let u=r.slice(0,49);r.length>=50&&(u=`${u}...`),c.title=t,c.description=r,c.shortDescription=u,c.datePublished=l,c.nameButton=a,c.linkButton=o,c.imageUrl=`/img/news/${e}.jpg`,s({newNews:await c.save(),id:e})})),updateNewsSIStoreItem=(e,t,r,a)=>new Promise((async(o,s)=>{if(!(e&&t&&r&&a))return s("No se ha recibido todos los datos"),!1;const n=await c.findOne({_id:e});n.title=t,n.description=r,n.price=a,o(await n.save())})),updateNewsCIStoreItem=(e,t,r,a)=>new Promise((async(o,s)=>{if(!(e&&t&&r&&a))return s("No se ha recibido todos los datos"),!1;const n=await c.findOne({_id:e});n.title=t,n.description=r,n.price=a,n.urlImage=`/img/storeItem/${e}.jpg`,o({newStoreItem:await n.save(),id:e})})),e.exports={addUser,updateUser,loginUser,getUsers,getData,delivery,returnDelivery,updateNewsSI,updateNewsCI,updateNewsSIStoreItem,updateNewsCIStoreItem}},3852:(e,t,r)=>{const a=r(5619),o=new(0,a.Schema)({username:{type:String,required:!0},password:{type:String,required:!0}},{collection:"userApp"});e.exports=a.model("userApp",o)},3038:(e,t,r)=>{const a=r(2127).Router(),{uploadNew:o,uploadStoreItem:s}=r(5489),n=r(2460),i=r(5628),{passImgNew:d}=r(2310),{addNews:c}=r(4221),{addStoreItem:l}=r(3127);a.post("/",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?n.addUser(e.body.username,e.body.password).then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)})):i.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/changePassword",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?n.updateUser(e.body.username,e.body.password,e.body.newPassword).then((r=>{r.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)})):i.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/login",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?n.loginUser(e.body.username,e.body.password).then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,400,r)})):i.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/listUsers",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?n.getUsers().then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,400,r)})):i.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/getData",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?n.getData(e.body._id).then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,400,r)})):i.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/delivery",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?n.delivery(e.body.itemBuy).then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,400,r)})):i.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/returnDelivery",((e,t)=>{"4C79A286C3ADE40D27696F617F94D646B7A38236FF385DF962EFAA9755BB2CBD"==e.headers.token?n.returnDelivery(e.body.itemBuy).then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,400,r)})):i.error(e,t,"Acceso denegado",500,"La password de la req es incorrecta")})),a.post("/saveImageNew",o.single("image"),(async(e,t)=>{c(e.body.title,e.body.description,"/",e.body.nameBtn,e.body.url).then((r=>{d(r._id),i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)}))})),a.post("/saveSImage",((e,t)=>{n.updateNewsSI(e.body.id,e.body.title,e.body.description,e.body.nameBtn,e.body.url).then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)}))})),a.post("/saveCImage",o.single("image"),(async(e,t)=>{n.updateNewsCI(e.body.id,e.body.title,e.body.description,e.body.nameBtn,e.body.url).then((r=>{d(r.id),i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)}))})),a.post("/saveImageStoreItem",s.single("image"),(async(e,t)=>{l(e.body.name,e.body.description,e.body.price,"/").then((r=>{passImgStoreItem(r._id),i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)}))})),a.post("/saveSImageStoreItem",((e,t)=>{n.updateNewsSIStoreItem(e.body.id,e.body.name,e.body.description,e.body.price).then((r=>{i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)}))})),a.post("/saveCImageStoreItem",s.single("image"),(async(e,t)=>{n.updateNewsCIStoreItem(e.body.id,e.body.name,e.body.description,e.body.price).then((r=>{passImgStoreItem(r.id),i.success(e,t,r,200)})).catch((r=>{i.error(e,t,r,500,r)}))})),e.exports=a},9739:(e,t,r)=>{const a=r(3852),o=r(9043),s=r(6115),n=r(1962),i=r(6466),d=r(5013),c=r(3238),l=r(5750);o.Connect(),addUser=e=>{new a(e).save()},updateUser=async(e,t)=>{const r=await a.findOne({username:e});return r.password=t,await r.save()},getData=async e=>{let t={};return t=await get(e),t},get=async e=>new Promise((async(t,r)=>{null!=e&&(filter={email:e});const a=await s.findOne(filter).select({_id:1,names:1,birdOfDate:1,coint:1,experience:1,imageUrl:1,numberID:1,email:1,phone:1,registerOfDate:1});if(null==a)return void r("El usuario no esta registrado");let o=await d.find({userId:a._id}).populate({path:"itemId",select:"title description urlImage"});const{isBirthday:u,edad:p}=l.getAge(a.birdOfDate);let g=[];if(p<15){let e={path:"topics",select:"name imageTopic"};const t=await n.find({userId:a._id}).populate(e);let r={};for(let e=0;e<t.length;e++)r={_id:t[e]._id,name:t[e].topics.name,imageUrl:t[e].topics.imageTopic},g.push(r)}else{let e={path:"challengeId",select:"name categoryId"};const t=await i.find({userId:a._id}).select({_id:1,imageUrl:1,challengeId:1}).populate(e);let r={};for(let e=0;e<t.length;e++){const a=await c.findOne({_id:t[e].challengeId.categoryId}).select({imageUrl:1});r={_id:t[e]._id,name:t[e].challengeId.name,imageUrl:t[e].imageUrl,imageCategory:a.imageUrl},g.push(r)}}t({user:{_id:a._id,names:a.names,birdOfDate:a.birdOfDate,age:p,isBirthday:u,imageUrl:a.imageUrl,experience:a.experience,coint:a.coint,numberID:a.numberID,email:a.email,phone:a.phone,registerOfDate:a.registerOfDate},content:g,yourShopping:o})})),delivery=async(e,t)=>{const r=await d.findOne({_id:e});return r.deliveryDate=t,r.deliveryStatus=!0,await r.save()},returnDelivery=async e=>{const t=await d.findOne({_id:e});return t.deliveryDate="",t.deliveryStatus=!1,await t.save()},e.exports={addUser,updateUser,getData,delivery,returnDelivery}},7509:(e,t,r)=>{const a=r(8999),o=r(3691),s=r(6115);addYourShopping=(e,t,r)=>new Promise((async(n,i)=>{if(!e||!t)return i("No se ha recibido todos los datos"),!1;const d=o.getDate(),c={itemId:e,userId:t,shoppingDate:d},l=await s.findOne({_id:t});l.coint=l.coint-r,await l.save(),a.addYourShopping(c),n(c)})),updateYourShopping=e=>new Promise((async(t,r)=>{if(!e)return r("No se ha recibido ningun id"),!1;const s=o.getDate();t(await a.updateYourShopping(e,s))})),deleteYourShopping=e=>new Promise(((t,r)=>{if(!e)return r("No se ha encontrado la categoria"),!1;a.deleteYourShopping(e).then((()=>{t()})).catch((e=>{r(e)}))})),e.exports={addYourShopping,getYourShopping,updateYourShopping,deleteYourShopping}},5013:(e,t,r)=>{const a=r(5619),o=a.Schema,s=new o({itemId:{type:o.Types.ObjectId,ref:"storeItem"},userId:{type:o.Types.ObjectId,ref:"user"},shoppingDate:{type:String,required:!0},deliveryDate:{type:String,required:!1,default:""},deliveryStatus:{type:Boolean,required:!1,default:!1}},{collection:"yourShopping"});e.exports=a.model("yourShopping",s)},9460:(e,t,r)=>{const a=r(2127).Router(),o=r(7509),s=r(5628);a.post("/",((e,t)=>{o.addYourShopping(e.body.itemId,e.body.userId,e.body.price).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.get("/",((e,t)=>{const r=e.query.idYourShopping||null;o.getYourShopping(r).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.patch("/:id",((e,t)=>{o.updateYourShopping(e.params.id).then((r=>{s.success(e,t,r,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),a.delete("/:id",((e,t)=>{let r=e.params.id;o.deleteYourShopping(r).then((()=>{s.success(e,t,`YourShoppingio ${r} Eliminado`,200)})).catch((r=>{s.error(e,t,"Error Interno",500,r)}))})),e.exports=a},8999:(e,t,r)=>{const a=r(5013);r(9043).Connect(),addYourShopping=e=>{new a(e).save()},getYourShopping=async e=>{let t={};return null!=e&&(t={_id:e}),await a.find(t)},updateYourShopping=async(e,t)=>{const r=await a.findOne({_id:e});return r.deliveryDate=t,r.deliveryStatus=!r.deliveryStatus,await r.save()},deleteYourShopping=e=>a.deleteOne({_id:e}),e.exports={addYourShopping,getYourShopping,updateYourShopping,deleteYourShopping}},9043:(e,t,r)=>{const a=r(5619);e.exports={Connect:()=>{try{a.Promise=r.g.Promise,a.connect("mongodb://admin:Pachaapp2021_mongo@localhost:27017/pachaapp?authSource=admin&readPreference=primary&appname=MongoDB%20Compass&ssl=false",{useNewUrlParser:!0,useUnifiedTopology:!0})}catch(e){console.log("ocurrio un error: ",e)}},Close:function(){try{a.disconnect()}catch(e){console.log("ocurrio un error: ",e)}}}},5628:(e,t)=>{t.success=(e,t,r,a)=>{t.status(a||200).send({error:"",body:r})},t.error=(e,t,r,a,o)=>{console.error("[reponse error] ",o),t.status(a||500).send({error:r,body:"",status:a})}},5714:(e,t,r)=>{const a=r(116),o=r(395),s=r(1955),n=r(7499),i=r(3009),d=r(6173),c=r(9460),l=r(1900),u=r(9737),p=r(3815),g=r(810),h=r(9668),m=r(4674),y=r(3155),w=r(513),C=r(3038);e.exports=e=>{e.use("/category",a),e.use("/user",o),e.use("/calendar",s),e.use("/configuration",n),e.use("/news",i),e.use("/storeItem",d),e.use("/yourShopping",c),e.use("/funFacts",l),e.use("/challenge",u),e.use("/funFactsUser",p),e.use("/challengeUser",g),e.use("/course",h),e.use("/topics",m),e.use("/topicsUser",y),e.use("/getData",w),e.use("/webApp",C)}},5750:(e,t,r)=>{const a=r(3691);getAge=e=>{const t=a.getDate(),r=e.split("-"),o=t.split("-"),s=r[0],n=r[1],i=r[2],d=o[0],c=o[1];let l=o[2]-i,u=!1;return(c<n||c==n&&d<s)&&l--,c==n&&d==s&&(u=!0),{edad:l,isBirthday:u}},e.exports={getAge}},3691:e=>{getDate=()=>{const e=new Date;let t=e.getDate(),r=e.getMonth()+1;return t<=9&&(t=`0${t}`),r<=9&&(r=`0${r}`),`${t}-${r}-${e.getFullYear()}`},getFullDate=()=>{const e=new Date;let t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear(),o=e.getHours(),s=e.getMinutes();return t<=9&&(t=`0${t}`),r<=9&&(r=`0${r}`),o<=9&&(o=`0${o}`),s<=9&&(s=`0${s}`),`${t}-${r}-${a} ${o}:${s}`},e.exports={getDate,getFullDate}},2310:(e,t,r)=>{var a=r(5747);generateFolder=async e=>{var t=`./public/img/challengeUser/${e}`;a.existsSync(t)||a.mkdirSync(t)},passImg=async(e,t)=>{const r=`./public/img/challengeUser/${e}/${t}.jpg`;a.rename("./public/img/challengeUser/photoChallengue.jpg",r,(e=>{e&&console.log(e)}))},passImgNew=async e=>{const t=`./public/img/news/${e}.jpg`;a.rename("./public/img/news/image.jpg",t,(e=>{e&&console.log(e)}))},passImgStoreItem=async e=>{const t=`./public/img/storeItem/${e}.jpg`;a.rename("./public/img/storeItem/image.jpg",t,(e=>{e&&console.log(e)}))},e.exports={generateFolder,passImg,passImgNew,passImgStoreItem}},5489:(e,t,r)=>{const a=r(8633);var o=a.diskStorage({destination:function(e,t,r){r(null,"./public/img/challengeUser")},filename:function(e,t,r){r(null,t.fieldname+".jpg")}}),s=a.diskStorage({destination:function(e,t,r){r(null,"./public/img/news")},filename:function(e,t,r){r(null,t.fieldname+".jpg")}}),n=a.diskStorage({destination:function(e,t,r){r(null,"./public/img/storeItem")},filename:function(e,t,r){r(null,t.fieldname+".jpg")}}),i=a({storage:o}),d=a({storage:s}),c=a({storage:n});e.exports={uploadChallengeUser:i,uploadNew:d,uploadStoreItem:c}},479:e=>{"use strict";e.exports=require("cors")},2127:e=>{"use strict";e.exports=require("express")},5747:e=>{"use strict";e.exports=require("fs")},8605:e=>{"use strict";e.exports=require("http")},7211:e=>{"use strict";e.exports=require("https")},5619:e=>{"use strict";e.exports=require("mongoose")},8633:e=>{"use strict";e.exports=require("multer")},5622:e=>{"use strict";e.exports=require("path")}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,r),s.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{const e=r(2127),t=r(7211),a=(r(8605),r(5747)),o=r(5714),s=r(5622);var n=e();const i=r(479);let d;{d=443;const r={cert:a.readFileSync(s.resolve("./public.crt")),key:a.readFileSync(s.resolve("./private.key"))};n.use(e.json()),n.use(i()),n.use(e.urlencoded({extended:!1})),n.use("/",e.static("./public")),n.get("/*",((e,t)=>{t.sendFile(s.join(s.resolve("./"),"public/index.html"),(e=>{e&&t.status(500).send(e)}))})),o(n),t.createServer(r,n).listen(443),console.log("La aplicación esta escuchando en https://localhost:443")}})()})();